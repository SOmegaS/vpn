## Описание `vpn.dockerfile`

1. ```FROM ubuntu:latest AS base``` --- базовый образ

2. ```SHELL ["/bin/sh", "-eu", "-c"]```
     Задаёт shell (оболочку) для выполнения всех последующих команд в Dockerfile.
    - -e: Останавливает выполнение при возникновении ошибки.
    - -u: Останавливает выполнение, если используется необъявленная переменная.
  
3.  ```WORKDIR /build```
    - Устанавливает рабочую директорию /build для выполнения всех последующих команд.
    - Организует структуру сборки, чтобы временные файлы сохранялись в определённом месте.
4. ```RUN apt update``` --- Позволяет убедиться, что доступные версии пакетов актуальны перед их установкой.
5. ```
   RUN apt-get update && apt-get install -y \
    sudo \
    wget \
    tar \
    build-essential \
    iproute2 \
    && apt-get clean
   ```
   - Обновляет индекс пакетов.
   - Устанавливает необходимые утилиты и зависимости:
      - sudo: Для выполнения команд от имени суперпользователя.
      - wget: Для скачивания файлов.
      - tar: Для работы с архивами.
      - build-essential: Набор инструментов для компиляции.
      - iproute2: Для работы с сетевыми настройками.

    - Очищает кеш установленных пакетов.
  
6. ```RUN useradd -ms /bin/bash dockeruser```
    - Создаёт нового пользователя dockeruser с домашней директорией и оболочкой /bin/bash.
    - Зачем: Повышает безопасность контейнера, так как выполнение процессов от имени суперпользователя (root) не рекомендуется.
  
7. ```RUN echo 'dockeruser ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers```

8. ```USER dockeruser```
    - Устанавливает пользователя dockeruser для выполнения всех последующих команд.
    - Зачем: Повышает безопасность и соответствует принципу наименьших привилегий.

9.  ```WORKDIR /home/dockeruser```
    - Меняет рабочую директорию на домашнюю директорию dockeruser.
    - Зачем: Организует рабочее пространство для пользователя.
10. ```ENV GO_VERSION 1.23.1```
    - Устанавливает переменную окружения GO_VERSION со значением 1.23.1.
    - Зачем: Удобство обновления версии Go. При необходимости можно поменять только значение переменной.

11. ```
    RUN wget https://go.dev/dl/go${GO_VERSION}.linux-amd64.tar.gz && \
    sudo tar -C /usr/local -xzf go${GO_VERSION}.linux-amd64.tar.gz && \
    rm go${GO_VERSION}.linux-amd64.tar.gz
    ```
      - Скачивает указанный архив с Go из официального источника.
      - Распаковывает Go в /usr/local.
      - Удаляет скачанный архив.
      -  Зачем: Устанавливает Go для сборки и выполнения приложения.
12. ```ENV PATH="/usr/local/go/bin:${PATH}"  ```

  - Добавляет директорию /usr/local/go/bin в переменную PATH.
  - Зачем: Делает исполняемые файлы Go доступными в любой точке системы.
    
13. ```RUN go version```
  - Проверяет установленную версию Go.
  - Зачем: Удостоверяется, что Go установлен и работает корректно.
14. ```COPY . ./```
    - Копирует весь исходный код из текущей директории хоста в контейнер.
    - Зачем: Помещает файлы проекта в контейнер для последующей сборки.
   
15. ```ARG PORT=12345```
    - Создаёт аргумент сборки PORT с дефолтным значением 12345.
    - Зачем: Позволяет указать порт на этапе сборки.
16. ```EXPOSE ${PORT}```
    - Сообщает Docker, что контейнер использует порт `PORT`.
    - Зачем: Удобство для работы с опубликованными портами. Однако, EXPOSE носит декларативный характер и не публикует порты сам по себе.
   
17. ```RUN CGO_ENABLED=1 GOOS=linux GOARCH=amd64 CC=x86_64-linux-gnu-gcc go build -o vpn ~/cmd/client/main.go```
    1. ```CGO_ENABLED=1```

        - Что делает: Включает поддержку `CGO (C language Go)`, которая позволяет Go-коду взаимодействовать с C-библиотеками.
        - Зачем: Необходим для использования сетевых функций, таких как создание TUN-интерфейсов, поскольку они зависят от системных вызовов и библиотек, написанных на C.
        - Примечание: Если установить `CGO_ENABLED=0`, то приложение будет полностью статическим (без зависимости от C-библиотек), но не сможет выполнять операции, зависящие от CGO.
    Вот подробное описание всех флагов перед командой go build:

    2. ```GOOS=linux```
    
        - Что делает: Устанавливает операционную систему целевого окружения в linux.
        - Зачем: Обеспечивает, что компиляция создаёт бинарник для Linux. Это нужно, так как контейнер работает в Linux-среде, независимо от ОС хост-машины.
        - Пример: Если вы собираете контейнер на Windows или macOS, то с этим флагом создаётся бинарный файл, совместимый с Linux.
    3. ```GOARCH=amd64```

        - Что делает: Устанавливает архитектуру процессора целевого окружения в amd64.
        - Зачем: Указывает, что бинарник должен быть совместим с 64-битными процессорами на архитектуре x86.
        - Примечание: Для других архитектур можно указать, например, `GOARCH=arm64` для 64-битных ARM процессоров.
   
    4. ```CC=x86_64-linux-gnu-gcc```

        - Что делает: Указывает компилятор C (в данном случае gcc), который будет использоваться для работы с CGO.
        - `x86_64-linux-gnu-gcc` — это версия GCC, предназначенная для сборки программ на 64-битных процессорах для Linux.
        - Зачем: CGO требует наличия компилятора C для взаимодействия с системными библиотеками.
        - Примечание: Без этого флага компилятор Go использует стандартный компилятор по умолчанию, но явное указание помогает избежать несовместимости.

19.  ```CMD ["sudo", "./vpn"]```
